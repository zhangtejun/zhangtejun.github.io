---
layout: post
title:  "rabbitMQ"
date:   2019-12-19 09:34:23
author: zhangtejun
categories: Java
---
#####
消息包含2个部分：有效负载（payload）和标签（label）。
有效负载就是你想要传输的数据，它可以是任何内容。标签描述了有效负载，并且rabbitMQ用它来决定谁将获得消息的拷贝。


AMQP消息路由必须有三部分：
* 交换器
* 队列
* 绑定

消费者通过2种方式藏特定的队列中接收消息：
1. 通过AMQP的basic.consume命令订阅。
2. 某些时候，只想从队列中获取单条信息而不是持久订阅。

当rabbit队列拥有多个消费者，队列收到的消息将以循环的方式发送给消费者。每条消息只会发给一个订阅的消费者。

消费者接收到每一条消息都必须进行确认，消费者必须通过AMQP的basic.ack命令显示的向RabbitMQ发送一个确认，或者在订阅到队列的时候就
将auto_ack 设置为true。设置了auto_ack,一旦消费者接收到消息，RabbitMQ会自动确认该消息。

服务器会根据消息的路由健来将消息从交换器路由到队列，如何处理投递到多个队列的情况?

不同交换器类型： 每一种都实现了不同的算法。
1. direct 如果路由匹配的话，消息就被投递到对应的队列。direct交换器包含一个空白字符串名称的默认交换器。
    当申明一个队列时，它会自动绑定到默认交换器，并以队列的名称作为路由键。
2. fanout 会将收到的消息广播到绑定的队列上
3. topic  可以使来自不同源头的消息能够到达同一个队列。（新的队列绑定到已有的同一个交换器）
4. headers  headers允许你匹配AMQP消息的header而不是路由的键，除此之外，它和direct交换器完全一致，但是性能差很多，所以几乎用不到。

##### 持久化
消息想要恢复，必须要满足：
1. 把它的投递模式选项设置为2（持久）
2. 发送到持久的交换器
3. 发送到持久的队列

其实现的方式是将它们写入磁盘上的一个持久化日志文件。当发送一条持久化的消息到持久化交换器上时，rabbit会在消息提交到日志文件后才发送响应。

